<html> 
    <head>
        <meta charset="UTF-8" />
        <title>Library Page</title>
        <link rel="stylesheet" href="css/library.css">
        <script src="js/input.js"></script>
    </head>
    <body>
      <div id="spinning-thingy" onclick="window.open('index.html')">
        <img src = "css/VinylBG2_noBG.png" width="90" height="90">
      </div>
        <h1>Music library</h1>
        <nav>
          <div class="nav-sort-re">
            <a href="library_date.html">Sorted alphabetically</a>
          </div>
        </nav>
        <div id="LIB_container">
        </div>

        <script>
          document.addEventListener('DOMContentLoaded', ()  => {
            let albums = [];
            const container = document.getElementById("LIB_container");
            const albumCount = Number(localStorage.getItem('albumCount'));
            let sort = [];
            for (let i = 0; i < albumCount; i++) {
            sort[i] = (localStorage.getItem('albumName' + (i + 1)) ?? '').toLowerCase() + '§' + (i + 1);
            }



            function bubbleSort(array) {
              let tries = 1;
              let x;
              let y
              while (tries > 0) {
                tries = 0
                for (let i = 0; i < array.length - 1; i++) {
                  if(array[i] > array[i + 1]) {
                    x = array[i];
                    y = array[i + 1];
                    array[i] = y;
                    array[i + 1] = x;
                    tries += 1;
                  }
                }
                if(tries  == 0){
                  return array;
                }
              }
            }



            bubbleSort(sort);



            for (let i = 0; i < albumCount; i++) {
                const idx = sort[i].split('§')[1];
                albums[i] = localStorage.getItem('linkPath' + sort[i].split('§')[1]);
                const div = document.createElement("div");
                div.id = "album" + (i + 1); 
                div.classList.add("album");
                div.dataset.idx = idx;
                div.textContent = localStorage.getItem('albumName' + sort[i].split('§')[1]) + " by " + localStorage.getItem('artistName' + sort[i].split('§')[1]);
                container.appendChild(div);
            }

            document.addEventListener('click',(event)=>{
              if(event.target && event.target.classList.contains('album')){
                const idx = event.target.dataset.idx;
                const albumLink = localStorage.getItem('linkPath' + idx);
                if (!albumLink) return;
                localStorage.setItem('currentalbum', albumLink);

                //alert(localStorage.getItem('currentalbum'));
                const currentalbum = localStorage.getItem('currentalbum').replace(
                  'https://open.spotify.com/album/','').split('?')[0];
                const playerLink = "player.html?id=" + currentalbum

                window.open(playerLink);
              //https://open.spotify.com/album/2164xFQmRLyfnHxqKoFPj5?si=HyvxX_iVS6eB3BNgdkhPxA
              // -> 2164xFQmRLyfnHxqKoFPj5
              }

            })
          });
        </script>
    </body>
</html>
