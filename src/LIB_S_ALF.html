<html> 
    <head>
        <meta charset="UTF-8" />
        <title>Library Page</title>
        <link rel="stylesheet" href="css/library.css">
        <script src="js/input.js"></script>
    </head>
    <body>
      <div id="spinning-thingy" onclick="window.open('index.html')">
        <img src = "VinylBG2_noBG.png" width="90" height="90">
      </div>
        <h1>Music library</h1>
        <nav>
          <div class="nav-sort-re">
            <a href="library.html">Sort by recent</a>
          </div>
        </nav>
        <div id="LIB_container">
        </div>
        <button id="test_button">Test</button>
        <script>
          document.addEventListener('DOMContentLoaded', ()  => {
            let songs = [];
            const container = document.getElementById("LIB_container");
            const songCount = Number(localStorage.getItem('songCount'));
            let sort = [];
            for (let i = 0; i < songCount; i++) {
            sort[i] = localStorage.getItem('songName' + (i + 1))+ (i + 1)
            }
            sort.sort();
            for (let i = 0; i < songCount; i++) {
                songs[i] = localStorage.getItem('linkPath' + sort[i].replace(/\D+/g, ''));
                const div = document.createElement("div");
                div.id = "song" + (i + 1); 
                div.classList.add("song");
                div.textContent = localStorage.getItem('songName' + sort[i].replace(/\D+/g, '')) + " by " + localStorage.getItem('artistName' + sort[i].replace(/\D+/g, ''));
                container.appendChild(div);
            }
            const button = document.getElementById('test_button');
                button.addEventListener('click',()=>{
                  let sort = [];
                  for (let i = 0; i < songCount; i++) {
                  sort[i] = localStorage.getItem('songName' + (i + 1))+ (i + 1)
                  }
                  sort.sort();
                  alert(sort[0].replace(/\D+/g, ''));
                })

            document.addEventListener('click',()=>{
              if(event.target && event.target.classList.contains('song')){
                const number = event.target.id.replace('song','');
                const songLink = localStorage.getItem('linkPath' + number);
                localStorage.setItem('currentSong', songLink);
                const currentSong = localStorage.getItem('currentSong').replace(
                'https://open.spotify.com/album/','').split('?')[0];
                const playerLink = "player.html?id=" + currentSong
                alert(playerLink);
                window.open(playerLink);
              //https://open.spotify.com/album/2164xFQmRLyfnHxqKoFPj5?si=HyvxX_iVS6eB3BNgdkhPxA
              // -> 2164xFQmRLyfnHxqKoFPj5
              }

            })
          });
        </script>
    </body>
</html>
